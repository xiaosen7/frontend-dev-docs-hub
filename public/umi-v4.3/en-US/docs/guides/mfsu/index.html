<!DOCTYPE html><html><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta property="og:image" content="https://umijs.org/images/og-home.png">
<meta property="og:url" content="https://umijs.org/">
<meta property="og:type" content="article">
<meta property="og:site_name" content="Umi">
<meta property="og:description" content="Umi是可扩展的企业级前端应用框架。Umi 以路由为基础的，同时支持配置式路由和约定式路由，保证路由的功能完备，并以此进行功能扩展。然后配以生命周期完善的插件体系，覆盖从源码到构建产物的每个生命周期，支持各种功能扩展和业务需求。">
<meta property="twitter:image" content="https://umijs.org/images/og-home.png">
<meta property="twitter:site" content="https://umijs.org/">
<meta property="twitter:creator" content="Umi">
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:title" content="Umi">
<meta property="twitter:description" content="Umi是可扩展的企业级前端应用框架。Umi 以路由为基础的，同时支持配置式路由和约定式路由，保证路由的功能完备，并以此进行功能扩展。然后配以生命周期完善的插件体系，覆盖从源码到构建产物的每个生命周期，支持各种功能扩展和业务需求。">
<meta property="fb:app_id" content="922985738798968">
<link rel="shortcut icon" href="https://img.alicdn.com/tfs/TB1YHEpwUT1gK0jSZFhXXaAtVXa-28-27.svg">
<link rel="stylesheet" href="/umi.c9f82ed3.css">
<title data-rh="true">MFSU</title>
<meta data-rh="true" property="og:title" content="MFSU"/><meta data-rh="true" name="description" content="MFSU is a package acceleration solution based on the new feature of webpack5, Module Federation. Its core idea is to divide and conquer by separating the compilation of application source code and application dependencies, and building less frequently changed application dependencies into a Module Federation remote application, thus avoiding the compilation of dependencies during application hot updates."/><meta data-rh="true" property="og:description" content="MFSU is a package acceleration solution based on the new feature of webpack5, Module Federation. Its core idea is to divide and conquer by separating the compilation of application source code and application dependencies, and building less frequently changed application dependencies into a Module Federation remote application, thus avoiding the compilation of dependencies during application hot updates."/>
<link data-rh="true" rel="canonical" href="https://umijs.org//en-US/docs/guides/mfsu"/>
</head>
<body>
<noscript><b>Enable JavaScript to run this app.</b></noscript><div id="root"><!--$?--><template id="B:0"></template><div></div><!--/$--></div><script>window.__UMI_LOADER_DATA__ = {}</script>
<script async="" src="/umi.0bdf4102.js"></script>

</body></html><div hidden id="S:0"><!--$?--><template id="B:1"></template><div></div><!--/$--></div><script>function $RC(a,b){a=document.getElementById(a);b=document.getElementById(b);b.parentNode.removeChild(b);if(a){a=a.previousSibling;var f=a.parentNode,c=a.nextSibling,e=0;do{if(c&&8===c.nodeType){var d=c.data;if("/$"===d)if(0===e)break;else e--;else"$"!==d&&"$?"!==d&&"$!"!==d||e++}d=c.nextSibling;f.removeChild(c);c=d}while(c);for(;b.firstChild;)f.insertBefore(b.firstChild,c);a.data="$";a._reactRetry&&a._reactRetry()}};$RC("B:0","S:0")</script><div hidden id="S:1"><div class="dumi-default-doc-layout"><div class="dumi-default-header"><div class="dumi-default-header-content"><section class="dumi-default-header-left"><a class="dumi-default-logo" href="/en-US"><img src="https://gw.alipayobjects.com/zos/bmw-prod/598d14af-4f1c-497d-b579-5ac42cd4dd1f/k7bjua9c_w132_h130.png" alt="UmiJS"/>UmiJS<!-- --></a></section><section class="dumi-default-header-right"><ul class="dumi-default-navbar"><li><a href="/en-US/docs/introduce/introduce">Introduce</a></li><li><a class="active" href="/en-US/docs/guides/getting-started">Guide</a></li><li><a href="/en-US/docs/api/api">API</a></li><li><a href="/en-US/docs/max/introduce">Umi Max</a></li><li><a href="/en-US/blog/umi-4-rc">Blog</a></li></ul><div class="dumi-default-header-right-aside"><div class="dumi-default-search-bar"><svg viewBox="64 64 896 896" class="dumi-default-search-bar-svg"><path d="M909.6 854.5 649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0 0 11.6 0l43.6-43.5a8.2 8.2 0 0 0 0-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"></path></svg><input class="dumi-default-search-bar-input" placeholder="Type keywords..."/><span class="dumi-default-search-shortcut">⌘<!-- --> K<!-- --></span></div><a class="dumi-default-lang-switch" href="/docs/guides/mfsu">中文</a><span class="dumi-default-color-switch" data-dumi-tooltip="Light Mode" data-dumi-tooltip-bottom="true"><svg viewBox="0 0 16 16"><path d="M8 13a1 1 0 0 1 1 1v1a1 1 0 1 1-2 0v-1a1 1 0 0 1 1-1ZM8 3a1 1 0 0 1-1-1V1a1 1 0 1 1 2 0v1a1 1 0 0 1-1 1Zm7 4a1 1 0 1 1 0 2h-1a1 1 0 1 1 0-2h1ZM3 8a1 1 0 0 1-1 1H1a1 1 0 1 1 0-2h1a1 1 0 0 1 1 1Zm9.95 3.536.707.707a1 1 0 0 1-1.414 1.414l-.707-.707a1 1 0 0 1 1.414-1.414Zm-9.9-7.072-.707-.707a1 1 0 0 1 1.414-1.414l.707.707A1 1 0 0 1 3.05 4.464Zm9.9 0a1 1 0 0 1-1.414-1.414l.707-.707a1 1 0 0 1 1.414 1.414l-.707.707Zm-9.9 7.072a1 1 0 0 1 1.414 1.414l-.707.707a1 1 0 0 1-1.414-1.414l.707-.707ZM8 4a4 4 0 1 0 0 8 4 4 0 0 0 0-8Zm0 6.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5Z"></path></svg><select><option value="light" selected="">Light Mode<!-- --></option><option value="dark">Dark Mode<!-- --></option><option value="auto">Follow System<!-- --></option></select></span><a class="dumi-default-icon" data-dumi-tooltip="GitHub" data-dumi-tooltip-bottom="true" target="_blank" href="https://github.com/umijs/umi" rel="noreferrer"><svg viewBox="64 64 896 896"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></a><div class="dumi-default-lang-select" style="border-inline-start:1px solid #d0d5d8;margin-inline-start:15px;padding-inline-start:5px"><select style="padding-top:1px;padding-bottom:1px"><option value="4.3.31" selected="">4.3.31<!-- --></option><option value="3.x">3.x<!-- --></option></select><svg viewBox="64 64 896 896"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></div></div></section><button type="button" class="dumi-default-header-menu-btn"><svg viewBox="64 64 896 896"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></button></div></div><div class="dumi-default-doc-layout-mobile-bar"><button type="button" class="dumi-default-sidebar-btn"><svg viewBox="64 64 896 896"><path d="M120 230h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm0 424h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm784 140H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-424H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"></path></svg>Sidebar<!-- --></button></div><main><div class="dumi-default-sidebar"><dl class="dumi-default-sidebar-group"><dd><a title="Getting Started" class="" href="/en-US/docs/guides/getting-started">Getting Started</a></dd><dd><a title="Development Environment" class="" href="/en-US/docs/guides/prepare">Development Environment</a></dd><dd><a title="Directory Structure" class="" href="/en-US/docs/guides/directory-structure">Directory Structure</a></dd><dd><a title="Routing" class="" href="/en-US/docs/guides/routes">Routing</a></dd><dd><a title="Plugins" class="" href="/en-US/docs/guides/use-plugins">Plugins</a></dd><dd><a title="Mock" class="" href="/en-US/docs/guides/mock">Mock</a></dd><dd><a title="Proxy" class="" href="/en-US/docs/guides/proxy">Proxy</a></dd><dd><a title="Styles" class="" href="/en-US/docs/guides/styling">Styles</a></dd><dd><a title="Route Data Loading" class="" href="/en-US/docs/guides/client-loader">Route Data Loading</a></dd><dd><a title="TypeScript" class="" href="/en-US/docs/guides/typescript">TypeScript</a></dd><dd><a title="Environment Variables" class="" href="/en-US/docs/guides/env-variables">Environment Variables</a></dd><dd><a title="Scaffolding" class="" href="/en-US/docs/guides/boilerplate">Scaffolding</a></dd><dd><a title="Micro Generators" class="" href="/en-US/docs/guides/generator">Micro Generators</a></dd><dd><a title="Coding Standards" class="" href="/en-US/docs/guides/lint">Coding Standards</a></dd><dd><a title="Debugging" class="" href="/en-US/docs/guides/debug">Debugging</a></dd><dd><a title="Testing" class="" href="/en-US/docs/guides/test">Testing</a></dd><dd><a title="Plugin Development" class="" href="/en-US/docs/guides/plugins">Plugin Development</a></dd><dd><a title="Using Vue" class="" href="/en-US/docs/guides/use-vue">Using Vue</a></dd><dd><a title="MPA Mode" class="" href="/en-US/docs/guides/mpa">MPA Mode</a></dd><dd><a title="MFSU" aria-current="page" class="active" href="/en-US/docs/guides/mfsu">MFSU</a></dd></dl></div><div class="dumi-default-content"><article><!--$?--><template id="B:2"></template><div></div><!--/$--></article><footer class="dumi-default-content-footer"><dl><dd><svg viewBox="64 64 896 896"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"></path><path d="M686.7 638.6 544.1 535.5V288c0-4.4-3.6-8-8-8H488c-4.4 0-8 3.6-8 8v275.4c0 2.6 1.2 5 3.3 6.5l165.4 120.6c3.6 2.6 8.6 1.8 11.2-1.7l28.6-39c2.6-3.7 1.8-8.7-1.8-11.2z"></path></svg>Last updated: <!-- --><time dateTime=""></time></dd></dl><nav></nav></footer><div class="dumi-default-footer">Open-source MIT Licensed | Copyright © 2017-present</div></div><div class="dumi-default-doc-layout-toc-wrapper"><h4>TABLE OF CONTENTS</h4></div></main></div></div><script>$RC("B:1","S:1")</script><div hidden id="S:2"><div class="markdown"><h1 id="mfsu"><a aria-hidden="true" tabindex="-1" href="#mfsu"><span class="icon icon-link"></span></a>MFSU<!-- --></h1><h2 id="what-is-mfsu"><a aria-hidden="true" tabindex="-1" href="#what-is-mfsu"><span class="icon icon-link"></span></a>What is MFSU<!-- --></h2><p>MFSU is a package acceleration solution based on the new feature of webpack5, Module Federation. Its core idea is to divide and conquer by separating the compilation of application source code and application dependencies, and building less frequently changed application dependencies into a Module Federation remote application, thus avoiding the compilation of dependencies during application hot updates.</p><p>Activating MFSU significantly reduces the time needed for hot updates; therefore, we have enabled the MFSU feature by default in Umi projects. Of course, you can also disable it by configuring <!-- --><code>mfsu: false</code>.<!-- --></p><h2 id="two-strategies-of-mfsu"><a aria-hidden="true" tabindex="-1" href="#two-strategies-of-mfsu"><span class="icon icon-link"></span></a>Two Strategies of MFSU<!-- --></h2><p>The key point of MFSU is how to analyze the actual dependencies used in the application code. MFSU has two working modes based on different analysis methods.</p><h3 id="normal-strategy-compile-time-analysis"><a aria-hidden="true" tabindex="-1" href="#normal-strategy-compile-time-analysis"><span class="icon icon-link"></span></a>Normal Strategy (Compile-time Analysis)<!-- --></h3><p>Use the following configuration to enable</p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-ts"><div class=""><div class=""><span class="token plain">mfsu</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="highlighted"><div class=""><span class="token plain">  strategy</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;normal&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token punctuation">}</span></div></div></pre></div><p>In modern front-end projects, code needs to be transpiled before it is used in production. During this process, the transpiler (like babel) will insert new dependencies into the code. These inserted dependencies are invisible at the project code level but are collected through the transpilation plugins.</p><p>The compile-time analysis working mode of MFSU first compiles the application project source code separately, collecting the project&#x27;s own dependencies and the dependencies introduced during compilation. After the compilation of the project code is completed, the collected results are used to continue the construction of the project dependency part of the code.</p><p>The entire process is serial, as shown in the example of building React references in the diagram below.</p><p><img src="https://gw.alipayobjects.com/mdn/rms_ffea06/afts/img/A*VRdhQZDag1UAAAAAAAAAAAAAARQnAQ" alt="normal-process"/></p><h3 id="eager-strategy-scanning-method"><a aria-hidden="true" tabindex="-1" href="#eager-strategy-scanning-method"><span class="icon icon-link"></span></a>Eager Strategy (Scanning Method)<!-- --></h3><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-ts"><div class=""><div class=""><span class="token plain">mfsu</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="highlighted"><div class=""><span class="token plain">  strategy</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;eager&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token punctuation">}</span></div></div></pre></div><p>Different from the compile-time analysis method, the scanning analysis method first reads all source code files in the project, and then obtains the project dependencies through static analysis. This process is very fast, taking only about 700ms for a project with 170,000 lines of code and more than 1400 files. The cost of such fast analysis is that the collected dependencies will miss the dependencies inserted during project code compilation; these dependencies will eventually be compiled and packaged together with the project code.</p><p>After analyzing the project dependencies, Umi takes this dependency information and parallelly compiles both the project code and dependencies.</p><p>As you can see from the diagram below, the compilation part is parallel.</p><p><img src="https://gw.alipayobjects.com/mdn/rms_ffea06/afts/img/A*XtZ1Spa9hMEAAAAAAAAAAAAAARQnAQ" alt="eager-process"/></p><h2 id="two-build-tools"><a aria-hidden="true" tabindex="-1" href="#two-build-tools"><span class="icon icon-link"></span></a>Two Build Tools<!-- --></h2><p>MFSU supports using Webpack or esbuild to build project dependencies. The default configuration uses Webpack, and it is very compatible with the Webpack ecosystem.
Esbuild can be enabled with <!-- --><code>mfsu: { esbuild: true }</code> to enjoy the high-speed construction of Esbuild.<!-- --></p><h2 id="how-to-choose"><a aria-hidden="true" tabindex="-1" href="#how-to-choose"><span class="icon icon-link"></span></a>How to Choose<!-- --></h2><p>The advantage of <!-- --><strong>compile-time analysis</strong> is that the collected dependencies are complete, and the construction and packaging of project codes and dependency codes are completely separated; after modifying the project code, only the project code part needs to be constructed. The disadvantage is also obvious, the construction process is serial.<!-- --></p><p>The advantage of the <!-- --><strong>scanning method</strong> is that the time-consuming code build is all parallel, which greatly improves the cold start time for larger projects. The downside is that some runtime dependencies will be compiled together with the project code.<!-- --></p><p>Based on the analysis of advantages and disadvantages, the following suggestions are given:</p><ul><li>If you do not use the Module Federation feature, and project dependencies do not change frequently, it is recommended to try esbuild build first</li><li>If you are in a mono repo project, it is recommended to use the &quot;normal&quot; strategy; it is recommended to enable the configuration <!-- --><a href="/en-US/docs/api/config#monoreporedirect">&quot;monoreporedirect&quot;</a></li><li>If your project is large and has a large code base, the &quot;eager&quot; strategy is recommended</li><li>If your project is just starting and dependencies will frequently change, the &quot;eager&quot; strategy is recommended</li><li>For other types of projects, feel free to choose.</li></ul><h2 id="common-issues"><a aria-hidden="true" tabindex="-1" href="#common-issues"><span class="icon icon-link"></span></a>Common Issues<!-- --></h2><h3 id="dependency-missing"><a aria-hidden="true" tabindex="-1" href="#dependency-missing"><span class="icon icon-link"></span></a>Dependency Missing<!-- --></h3><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-bash"><div class=""><div class=""><span class="token plain">error - </span><span class="token punctuation">[</span><span class="token plain">MFSU</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token plain">eager</span><span class="token punctuation">]</span><span class="token plain"> build worker failed AssertionError </span><span class="token punctuation">[</span><span class="token plain">ERR_ASSERTION</span><span class="token punctuation">]</span><span class="token plain">: filePath not found of lodash.capitalize</span></div></div></pre></div><p>Check your dependencies to ensure that the corresponding dependency has been installed. (As in the example of <!-- --><code>lodash.capitalize</code>)<!-- --></p><h3 id="multiple-instances-of-react"><a aria-hidden="true" tabindex="-1" href="#multiple-instances-of-react"><span class="icon icon-link"></span></a>Multiple Instances of React<!-- --></h3><p>The following error occurs in the browser</p><p><img src="https://gw.alipayobjects.com/mdn/rms_ffea06/afts/img/A*ScIJTZobWE4AAAAAAAAAAAAAARQnAQ" alt="multi-react-instance"/></p><p>The root cause is that in some complex scenarios, React&#x27;s code is packaged multiple times, resulting in multiple React instances at runtime. The solution is to avoid multiple instances using the <!-- --><code>shared</code> configuration of Module Federation.
If other dependencies also have multiple instances issues, they can be solved in a similar way.<!-- --></p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-ts"><div class=""><div class=""><span class="token plain">mfsu</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  shared</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="highlighted"><div class=""><span class="token plain">    react</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="highlighted"><div class=""><span class="token plain">      singleton</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class="highlighted"><div class=""><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">,</span></div></div></pre></div></div><div class="dumi-default-container markdown" data-type="info"><svg viewBox="64 64 896 896"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"></path><path d="M464 336a48 48 0 1 0 96 0 48 48 0 1 0-96 0zm72 112h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V456c0-4.4-3.6-8-8-8z"></path></svg><h4>⚠️</h4><section><p>If the <!-- --><a href="/en-US/docs/max/mf">MF plugin</a> is enabled, you need to enable <!-- --><code>shared</code>, please <!-- --><a href="/en-US/docs/max/mf#using-with-mfsu">refer to</a>.<!-- --></p></section></div><div class="markdown"><h3 id="externals-script-compatibility-issue"><a aria-hidden="true" tabindex="-1" href="#externals-script-compatibility-issue"><span class="icon icon-link"></span></a>Externals script Compatibility Issue<!-- --></h3><p>If project dependency A depends on B, and the project has configured an externals script type for B as follows.</p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-ts"><div class=""><div class=""><span class="token plain">externals</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  b</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&#x27;script https://cdn/b.js&#x27;</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token punctuation">]</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token punctuation">}</span></div></div></pre></div><p>It will cause an error when enabling MFSU.</p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-ts"><div class=""><div class=""><span class="token keyword">import</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword">as</span><span class="token plain"> b </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;b&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token plain">b</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></div></pre></div><p>Normally, b should be Module information, but what is obtained is <!-- --><code>Promise&lt;Module&gt;</code>. I understand this is a problem with webpack, which has not handled the compatibility issue between externals script and module federation well, possibly also because externals script is rarely known and used.<!-- --></p><p>The solution is not to use it mixed with MFSU, only enable it when <!-- --><code>process.env.NODE_ENV === &#x27;production&#x27;</code>.<!-- --></p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-ts"><div class=""><div class=""><span class="token plain">externals</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token operator">...</span><span class="token punctuation">(</span><span class="token plain">process</span><span class="token punctuation">.</span><span class="token plain">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;production&#x27;</span><span class="token plain"> </span><span class="token operator">?</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain">b</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&#x27;script https://cdn/b.js&#x27;</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token punctuation">}</span></div></div></pre></div><h3 id="dependency-cycle-issue"><a aria-hidden="true" tabindex="-1" href="#dependency-cycle-issue"><span class="icon icon-link"></span></a>Dependency Cycle Issue<!-- --></h3><h4 id="scenario-1"><a aria-hidden="true" tabindex="-1" href="#scenario-1"><span class="icon icon-link"></span></a>Scenario 1<!-- --></h4><p>In a monorepo, the project depends on package A, A depends on package B, and B is provided by a subpackage in the project monorepo. This forms a situation where the project source code depends on A, and A depends back on the project source code.
In this case, it is recommended to use the MFSU&#x27;s exclude configuration.</p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-ts"><div class=""><div class=""><span class="token plain">mfsu</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="highlighted"><div class=""><span class="token plain">  exclude</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div></div><div class="highlighted"><div class=""><span class="token plain">    </span><span class="token string">&#x27;B&#x27;</span><span class="token plain"></span></div></div><div class="highlighted"><div class=""><span class="token plain">  </span><span class="token punctuation">]</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token punctuation">}</span></div></div></pre></div><h4 id="scenario-2"><a aria-hidden="true" tabindex="-1" href="#scenario-2"><span class="icon icon-link"></span></a>Scenario 2<!-- --></h4><p>An unreasonable implementation of a certain dependency in the project, the project relies on the functionality related to the Bigfish plugin (i.e., references the content under the <!-- --><code>.umi</code> directory); after enabling MFSU, the project may not compile normally; The solution and Scenario 1 are a similar configuration. Add this package to the <!-- --><code>mfsu.exclude</code> field.<!-- --></p><h3 id="worker-compatibility-issue"><a aria-hidden="true" tabindex="-1" href="#worker-compatibility-issue"><span class="icon icon-link"></span></a>Worker Compatibility Issue<!-- --></h3><p>If the project code needs to be used in a Worker, then the dependencies required by the Worker need to be added to the MFSU&#x27;s <!-- --><a href="/en-US/docs/api/config#mfsu"><code>exclude</code> configuration<!-- --></a>.
Worker related dependencies can only be bypassed in this way, because Module Federation shares modules through the <!-- --><code>window</code> object, so modules from Module Federation cannot be used in workers.<!-- --></p></div></div><script>$RC("B:2","S:2")</script>