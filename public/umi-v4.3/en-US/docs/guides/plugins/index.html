<!DOCTYPE html><html><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta property="og:image" content="https://umijs.org/images/og-home.png">
<meta property="og:url" content="https://umijs.org/">
<meta property="og:type" content="article">
<meta property="og:site_name" content="Umi">
<meta property="og:description" content="Umi是可扩展的企业级前端应用框架。Umi 以路由为基础的，同时支持配置式路由和约定式路由，保证路由的功能完备，并以此进行功能扩展。然后配以生命周期完善的插件体系，覆盖从源码到构建产物的每个生命周期，支持各种功能扩展和业务需求。">
<meta property="twitter:image" content="https://umijs.org/images/og-home.png">
<meta property="twitter:site" content="https://umijs.org/">
<meta property="twitter:creator" content="Umi">
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:title" content="Umi">
<meta property="twitter:description" content="Umi是可扩展的企业级前端应用框架。Umi 以路由为基础的，同时支持配置式路由和约定式路由，保证路由的功能完备，并以此进行功能扩展。然后配以生命周期完善的插件体系，覆盖从源码到构建产物的每个生命周期，支持各种功能扩展和业务需求。">
<meta property="fb:app_id" content="922985738798968">
<link rel="shortcut icon" href="https://img.alicdn.com/tfs/TB1YHEpwUT1gK0jSZFhXXaAtVXa-28-27.svg">
<link rel="stylesheet" href="/umi.c9f82ed3.css">
<title data-rh="true">Plugin Development</title>
<meta data-rh="true" property="og:title" content="Plugin Development"/><meta data-rh="true" name="description" content="The essence of Umi lies in its plugin mechanism. Based on the plugin mechanism of Umi, you can enhance the build-time and runtime capabilities of your project. You can freely write plugins using the Plugin API we provide, thus achieving rich functionalities like modifying the code packaging configuration, modifying startup code, convention directory structure, modifying HTML, etc."/><meta data-rh="true" property="og:description" content="The essence of Umi lies in its plugin mechanism. Based on the plugin mechanism of Umi, you can enhance the build-time and runtime capabilities of your project. You can freely write plugins using the Plugin API we provide, thus achieving rich functionalities like modifying the code packaging configuration, modifying startup code, convention directory structure, modifying HTML, etc."/>
<link data-rh="true" rel="canonical" href="https://umijs.org//en-US/docs/guides/plugins"/>
</head>
<body>
<noscript><b>Enable JavaScript to run this app.</b></noscript><div id="root"><!--$?--><template id="B:0"></template><div></div><!--/$--></div><script>window.__UMI_LOADER_DATA__ = {}</script>
<script async="" src="/umi.0bdf4102.js"></script>

</body></html><div hidden id="S:0"><!--$?--><template id="B:1"></template><div></div><!--/$--></div><script>function $RC(a,b){a=document.getElementById(a);b=document.getElementById(b);b.parentNode.removeChild(b);if(a){a=a.previousSibling;var f=a.parentNode,c=a.nextSibling,e=0;do{if(c&&8===c.nodeType){var d=c.data;if("/$"===d)if(0===e)break;else e--;else"$"!==d&&"$?"!==d&&"$!"!==d||e++}d=c.nextSibling;f.removeChild(c);c=d}while(c);for(;b.firstChild;)f.insertBefore(b.firstChild,c);a.data="$";a._reactRetry&&a._reactRetry()}};$RC("B:0","S:0")</script><div hidden id="S:1"><div class="dumi-default-doc-layout"><div class="dumi-default-header"><div class="dumi-default-header-content"><section class="dumi-default-header-left"><a class="dumi-default-logo" href="/en-US"><img src="https://gw.alipayobjects.com/zos/bmw-prod/598d14af-4f1c-497d-b579-5ac42cd4dd1f/k7bjua9c_w132_h130.png" alt="UmiJS"/>UmiJS<!-- --></a></section><section class="dumi-default-header-right"><ul class="dumi-default-navbar"><li><a href="/en-US/docs/introduce/introduce">Introduce</a></li><li><a class="active" href="/en-US/docs/guides/getting-started">Guide</a></li><li><a href="/en-US/docs/api/api">API</a></li><li><a href="/en-US/docs/max/introduce">Umi Max</a></li><li><a href="/en-US/blog/umi-4-rc">Blog</a></li></ul><div class="dumi-default-header-right-aside"><div class="dumi-default-search-bar"><svg viewBox="64 64 896 896" class="dumi-default-search-bar-svg"><path d="M909.6 854.5 649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0 0 11.6 0l43.6-43.5a8.2 8.2 0 0 0 0-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"></path></svg><input class="dumi-default-search-bar-input" placeholder="Type keywords..."/><span class="dumi-default-search-shortcut">⌘<!-- --> K<!-- --></span></div><a class="dumi-default-lang-switch" href="/docs/guides/plugins">中文</a><span class="dumi-default-color-switch" data-dumi-tooltip="Light Mode" data-dumi-tooltip-bottom="true"><svg viewBox="0 0 16 16"><path d="M8 13a1 1 0 0 1 1 1v1a1 1 0 1 1-2 0v-1a1 1 0 0 1 1-1ZM8 3a1 1 0 0 1-1-1V1a1 1 0 1 1 2 0v1a1 1 0 0 1-1 1Zm7 4a1 1 0 1 1 0 2h-1a1 1 0 1 1 0-2h1ZM3 8a1 1 0 0 1-1 1H1a1 1 0 1 1 0-2h1a1 1 0 0 1 1 1Zm9.95 3.536.707.707a1 1 0 0 1-1.414 1.414l-.707-.707a1 1 0 0 1 1.414-1.414Zm-9.9-7.072-.707-.707a1 1 0 0 1 1.414-1.414l.707.707A1 1 0 0 1 3.05 4.464Zm9.9 0a1 1 0 0 1-1.414-1.414l.707-.707a1 1 0 0 1 1.414 1.414l-.707.707Zm-9.9 7.072a1 1 0 0 1 1.414 1.414l-.707.707a1 1 0 0 1-1.414-1.414l.707-.707ZM8 4a4 4 0 1 0 0 8 4 4 0 0 0 0-8Zm0 6.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5Z"></path></svg><select><option value="light" selected="">Light Mode<!-- --></option><option value="dark">Dark Mode<!-- --></option><option value="auto">Follow System<!-- --></option></select></span><a class="dumi-default-icon" data-dumi-tooltip="GitHub" data-dumi-tooltip-bottom="true" target="_blank" href="https://github.com/umijs/umi" rel="noreferrer"><svg viewBox="64 64 896 896"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></a><div class="dumi-default-lang-select" style="border-inline-start:1px solid #d0d5d8;margin-inline-start:15px;padding-inline-start:5px"><select style="padding-top:1px;padding-bottom:1px"><option value="4.3.31" selected="">4.3.31<!-- --></option><option value="3.x">3.x<!-- --></option></select><svg viewBox="64 64 896 896"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></div></div></section><button type="button" class="dumi-default-header-menu-btn"><svg viewBox="64 64 896 896"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></button></div></div><div class="dumi-default-doc-layout-mobile-bar"><button type="button" class="dumi-default-sidebar-btn"><svg viewBox="64 64 896 896"><path d="M120 230h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm0 424h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm784 140H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-424H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"></path></svg>Sidebar<!-- --></button></div><main><div class="dumi-default-sidebar"><dl class="dumi-default-sidebar-group"><dd><a title="Getting Started" class="" href="/en-US/docs/guides/getting-started">Getting Started</a></dd><dd><a title="Development Environment" class="" href="/en-US/docs/guides/prepare">Development Environment</a></dd><dd><a title="Directory Structure" class="" href="/en-US/docs/guides/directory-structure">Directory Structure</a></dd><dd><a title="Routing" class="" href="/en-US/docs/guides/routes">Routing</a></dd><dd><a title="Plugins" class="" href="/en-US/docs/guides/use-plugins">Plugins</a></dd><dd><a title="Mock" class="" href="/en-US/docs/guides/mock">Mock</a></dd><dd><a title="Proxy" class="" href="/en-US/docs/guides/proxy">Proxy</a></dd><dd><a title="Styles" class="" href="/en-US/docs/guides/styling">Styles</a></dd><dd><a title="Route Data Loading" class="" href="/en-US/docs/guides/client-loader">Route Data Loading</a></dd><dd><a title="TypeScript" class="" href="/en-US/docs/guides/typescript">TypeScript</a></dd><dd><a title="Environment Variables" class="" href="/en-US/docs/guides/env-variables">Environment Variables</a></dd><dd><a title="Scaffolding" class="" href="/en-US/docs/guides/boilerplate">Scaffolding</a></dd><dd><a title="Micro Generators" class="" href="/en-US/docs/guides/generator">Micro Generators</a></dd><dd><a title="Coding Standards" class="" href="/en-US/docs/guides/lint">Coding Standards</a></dd><dd><a title="Debugging" class="" href="/en-US/docs/guides/debug">Debugging</a></dd><dd><a title="Testing" class="" href="/en-US/docs/guides/test">Testing</a></dd><dd><a title="Plugin Development" aria-current="page" class="active" href="/en-US/docs/guides/plugins">Plugin Development</a></dd><dd><a title="Using Vue" class="" href="/en-US/docs/guides/use-vue">Using Vue</a></dd><dd><a title="MPA Mode" class="" href="/en-US/docs/guides/mpa">MPA Mode</a></dd><dd><a title="MFSU" class="" href="/en-US/docs/guides/mfsu">MFSU</a></dd></dl></div><div class="dumi-default-content"><article><!--$?--><template id="B:2"></template><div></div><!--/$--></article><footer class="dumi-default-content-footer"><dl><dd><svg viewBox="64 64 896 896"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"></path><path d="M686.7 638.6 544.1 535.5V288c0-4.4-3.6-8-8-8H488c-4.4 0-8 3.6-8 8v275.4c0 2.6 1.2 5 3.3 6.5l165.4 120.6c3.6 2.6 8.6 1.8 11.2-1.7l28.6-39c2.6-3.7 1.8-8.7-1.8-11.2z"></path></svg>Last updated: <!-- --><time dateTime=""></time></dd></dl><nav></nav></footer><div class="dumi-default-footer">Open-source MIT Licensed | Copyright © 2017-present</div></div><div class="dumi-default-doc-layout-toc-wrapper"><h4>TABLE OF CONTENTS</h4></div></main></div></div><script>$RC("B:1","S:1")</script><div hidden id="S:2"><div class="markdown"><h1 id="plugin-development"><a aria-hidden="true" tabindex="-1" href="#plugin-development"><span class="icon icon-link"></span></a>Plugin Development<!-- --></h1><p>The essence of Umi lies in its plugin mechanism. Based on the plugin mechanism of Umi, you can enhance the build-time and runtime capabilities of your project. You can freely write plugins using the <!-- --><a href="/en-US/docs/api/plugin-api">Plugin API</a> we provide, thus achieving rich functionalities like modifying the code packaging configuration, modifying startup code, convention directory structure, modifying HTML, etc.<!-- --></p><h2 id="core-concepts"><a aria-hidden="true" tabindex="-1" href="#core-concepts"><span class="icon icon-link"></span></a>Core Concepts<!-- --></h2><p>The essence of a plugin is a method that receives one parameter: api. Within the plugin, you can call methods provided by api to register some hooks, which Umi will execute at specific times.</p><p>For example:</p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-js"><div class=""><div class=""><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">IApi</span><span class="token imports"> </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;umi&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">
</span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter literal-property property">api</span><span class="token parameter operator">:</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">IApi</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  api</span><span class="token punctuation">.</span><span class="token method function property-access">describe</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token literal-property property">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;changeFavicon&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token literal-property property">config</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">      </span><span class="token function">schema</span><span class="token punctuation">(</span><span class="token parameter">joi</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">        </span><span class="token keyword control-flow">return</span><span class="token plain"> joi</span><span class="token punctuation">.</span><span class="token method function property-access">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token literal-property property">enableBy</span><span class="token operator">:</span><span class="token plain"> api</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">EnableBy</span><span class="token punctuation">.</span><span class="token property-access">config</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  api</span><span class="token punctuation">.</span><span class="token method function property-access">modifyConfig</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">memo</span><span class="token punctuation">)</span><span class="token arrow operator">=&gt;</span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    memo</span><span class="token punctuation">.</span><span class="token property-access">favicons</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> api</span><span class="token punctuation">.</span><span class="token property-access">userConfig</span><span class="token punctuation">.</span><span class="token property-access">changeFavicon</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> memo</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></div></pre></div><p>The purpose of this plugin is to change the favicons in the configuration based on the user-configured changeFavicon value (a very simple example with no practical use XD). As you can see, a plugin is essentially a method that receives the parameter api. In this method, we called <!-- --><code>api.modifyConfig</code> to register a hook: <!-- --><code>(memo)=&gt;{...}</code>. After you have configured <!-- --><code>changeFavicon</code> in the configuration, Umi will register the plugin. During Umi&#x27;s configuration collection lifecycle, the hook we registered in the plugin will be executed, changing the <!-- --><code>favicon</code> in the configuration to the <!-- --><code>changeFavicon</code> configured by the user.<!-- --></p><h3 id="plugin-and-preset"><a aria-hidden="true" tabindex="-1" href="#plugin-and-preset"><span class="icon icon-link"></span></a>plugin and preset<!-- --></h3><p>The role of a preset is to preset some plugins, which is typically used to register a batch of presets and plugins. In presets, the method mentioned above that accepts the api can have a return value, which is an object containing plugins and presets properties, for the purpose of registering the corresponding plugins or plugin sets.</p><p>For example:</p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-js"><div class=""><div class=""><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">IApi</span><span class="token imports"> </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;umi&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">
</span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter literal-property property">api</span><span class="token parameter operator">:</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">IApi</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&#x27;./plugin_foo&#x27;</span><span class="token punctuation">,</span><span class="token string">&#x27;./plugin_bar&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token literal-property property">presets</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&#x27;./preset_foo&#x27;</span><span class="token punctuation">]</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></div></pre></div><p>Their registration order is worth noting: presets are always registered before plugins. Umi maintains two queues to register presets and plugins sequentially, the registered <!-- --><code>preset_foo</code> in this example would be placed at the head of the presets queue, and <!-- --><code>plugin_foo</code> and <!-- --><code>plugin_bar</code> would be placed at the tail of the plugins queue one by one. The purpose of putting preset at the head is to ensure the order and relationship between presets are controllable.<!-- --></p><p>Another noteworthy point is: in plugins, you can also return some plugins or presets, but Umi won&#x27;t do anything about it.</p><h3 id="plugins-id-and-key"><a aria-hidden="true" tabindex="-1" href="#plugins-id-and-key"><span class="icon icon-link"></span></a>Plugin&#x27;s id and key<!-- --></h3><p>Each plugin corresponds to an id and key.</p><p>The id is an abbreviation for the plugin&#x27;s path and serves as the unique identifier of the plugin; while the key is the key name used for plugin configuration.</p><p>For example, the plugin <!-- --><code>node_modules/@umijs/plugin-foo/index.js</code>, typically, its id is <!-- --><code>@umijs/plugin-foo</code>, and the key is <!-- --><code>foo</code>. This allows developers to configure the item with the key name <!-- --><code>foo</code> in the configuration to configure the plugin.<!-- --></p><h2 id="enabling-plugins"><a aria-hidden="true" tabindex="-1" href="#enabling-plugins"><span class="icon icon-link"></span></a>Enabling Plugins<!-- --></h2><p>There are two ways to enable plugins: enable in environment variables and enable in configuration. (Different from <!-- --><code>umi@3</code>, we no longer support automatic enabling of plugins in the dependencies of <!-- --><code>package.json</code>)<!-- --></p><p>Note: Here we refer to third-party plugins, as Umi&#x27;s built-in plugins are universally enabled in the configuration through their keys.</p><h3 id="environment-variables"><a aria-hidden="true" tabindex="-1" href="#environment-variables"><span class="icon icon-link"></span></a>Environment Variables<!-- --></h3><p>You can also register additional plugins through the environment variables <!-- --><code>UMI_PRESETS</code> and <!-- --><code>UMI_PLUGINS</code>.
For example:<!-- --></p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-shell"><div class=""><div class=""><span class="token plain">$ UMI_PRESETS </span><span class="token operator">=</span><span class="token plain"> foo/preset.js umi dev</span></div></div></pre></div><p>Note: It is not recommended for use in projects, usually for secondary packaging based on Umi framework.</p><h3 id="configuration"><a aria-hidden="true" tabindex="-1" href="#configuration"><span class="icon icon-link"></span></a>Configuration<!-- --></h3><p>Plugins are configured in the configuration through <!-- --><code>presets</code> and <!-- --><code>plugins</code>, for example:<!-- --></p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-js"><div class=""><div class=""><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token literal-property property">presets</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&#x27;./preset/foo&#x27;</span><span class="token punctuation">,</span><span class="token string">&#x27;bar/presets&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&#x27;./plugin&#x27;</span><span class="token punctuation">,</span><span class="token plain"> require</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span><span class="token string">&#x27;plugin_foo&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token punctuation">}</span></div></div></pre></div><p>The content of the configuration is the path of the plugin.</p><h3 id="order-of-plugins"><a aria-hidden="true" tabindex="-1" href="#order-of-plugins"><span class="icon icon-link"></span></a>Order of Plugins<!-- --></h3><p>The registration of Umi plugins follows a certain order:</p><ul><li>All presets are registered before plugins.</li><li>Built-in plugins -&gt; plugins in environment variables -&gt; plugins in user config.</li><li>Plugins registered at the same time (in the same array) are registered in sequence.</li><li>Presets registered in a preset are executed immediately, while plugins registered are executed at the end.</li></ul><h2 id="disabling-plugins"><a aria-hidden="true" tabindex="-1" href="#disabling-plugins"><span class="icon icon-link"></span></a>Disabling Plugins<!-- --></h2><p>There are two ways to disable plugins</p><h3 id="configuring-key-as-false"><a aria-hidden="true" tabindex="-1" href="#configuring-key-as-false"><span class="icon icon-link"></span></a>Configuring key as false<!-- --></h3><p>For example:</p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-js"><div class=""><div class=""><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token literal-property property">mock</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token punctuation">}</span></div></div></pre></div><p>This would disable Umi&#x27;s built-in mock plugin.</p><h3 id="disabling-other-plugins-in-a-plugin"><a aria-hidden="true" tabindex="-1" href="#disabling-other-plugins-in-a-plugin"><span class="icon icon-link"></span></a>Disabling Other Plugins in a Plugin<!-- --></h3><p>This can be done by using <!-- --><code>api.skipPlugins(pluginId[])</code>, see <!-- --><a href="/en-US/docs/api/plugin-api">Plugin API</a> for more details.<!-- --></p><h2 id="viewing-plugin-registration-status"><a aria-hidden="true" tabindex="-1" href="#viewing-plugin-registration-status"><span class="icon icon-link"></span></a>Viewing Plugin Registration Status<!-- --></h2><h3 id="command-line"><a aria-hidden="true" tabindex="-1" href="#command-line"><span class="icon icon-link"></span></a>Command Line<!-- --></h3><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-shell"><div class=""><div class=""><span class="token plain">$ umi plugin list</span></div></div></pre></div><h2 id="configuring-plugins"><a aria-hidden="true" tabindex="-1" href="#configuring-plugins"><span class="icon icon-link"></span></a>Configuring Plugins<!-- --></h2><p>Configure plugins through the key of the plugin, for example:</p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-js"><div class=""><div class=""><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token literal-property property">mock</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token literal-property property">exclude</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&#x27;./foo&#x27;</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token punctuation">}</span></div></div></pre></div><p>Here mock is the key of Umi&#x27;s built-in mock plugin.</p><p>For instance, if we install a plugin <!-- --><code>umi-plugin-bar</code>, its default key is <!-- --><code>bar</code>, then it can be configured:<!-- --></p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-js"><div class=""><div class=""><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token literal-property property">bar</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token punctuation">}</span></div></div></pre></div><h3 id="default-naming-rules-for-plugin-keys"><a aria-hidden="true" tabindex="-1" href="#default-naming-rules-for-plugin-keys"><span class="icon icon-link"></span></a>Default Naming Rules for Plugin Keys<!-- --></h3><p>If the plugin is a package, the default value of the key will be the package name without prefix. For example, the default key for <!-- --><code>@umijs/plugin-foo</code> is <!-- --><code>foo</code>, and the default key for <!-- --><code>@alipay/umi-plugin-bar</code> is <!-- --><code>bar</code>. It is worth noting that this default rule requires your package name to conform to the Umi plugin naming convention.<!-- --></p><p>If the plugin is not a package, the default value of the key will be the filename of the plugin. For example, the default key for <!-- --><code>./plugins/foo.js</code> is <!-- --><code>foo</code>.<!-- --></p><p>To avoid unnecessary trouble, we recommend that you explicitly declare the key for your own written plugins.</p><h2 id="the-mechanism-and-lifecycle-of-umi-plugins"><a aria-hidden="true" tabindex="-1" href="#the-mechanism-and-lifecycle-of-umi-plugins"><span class="icon icon-link"></span></a>The Mechanism and Lifecycle of Umi Plugins<!-- --></h2><p><img src="https://gw.alipayobjects.com/mdn/rms_ffea06/afts/img/A*GKNdTZgPQCIAAAAAAAAAAAAAARQnAQ" alt="Umi Plugin Mechanism"/></p><h3 id="lifecycle"><a aria-hidden="true" tabindex="-1" href="#lifecycle"><span class="icon icon-link"></span></a>Lifecycle<!-- --></h3><ul><li>init stage: At this stage, Umi loads various configuration information. Including loading <!-- --><code>.env</code> files; requiring <!-- --><code>package.json</code>; loading user configurations; resolving all plugins (built-in plugins, environment variables, and user configs in sequence).<!-- --></li><li>initPresets stage: At this stage, Umi registers presets. Presets can register additional plugins by returning <!-- --><code>{ presets, plugins }</code>, where presets will be added to the top of the presets queue, and plugins will be added to the end of the plugins queue.<!-- --></li><li>initPlugins stage: At this stage, Umi registers plugins. These plugins include additional plugins added by presets in the previous stage. A point worth noting is that even though plugins can also <!-- --><code>return { presets, plugins }</code>, Umi will not do anything about it. The init of a plugin is essentially executing the plugin&#x27;s code (but the essence of the plugin&#x27;s code is just calling the api to register various hooks, and the execution of hooks does not occur at this stage, so this is called plugin registration).<!-- --></li><li>resolveConfig stage: At this stage, Umi organizes definitions of <!-- --><code>config schema</code> from various plugins, then executes hooks like <!-- --><code>modifyConfig</code>, <!-- --><code>modifyDefaultConfig</code>, <!-- --><code>modifyPaths</code> etc., to collect configurations.<!-- --></li><li>collectionAppData stage: At this stage, Umi executes the <!-- --><code>modifyAppData</code> hook, to maintain the metadata of the App. (<!-- --><code>AppData</code> is a new api added in <!-- --><code>umi@4</code>)<!-- --></li><li>onCheck stage: At this stage, Umi executes the <!-- --><code>onCheck</code> hook.<!-- --></li><li>onStart stage: At this stage, Umi executes the <!-- --><code>onStart</code> hook.<!-- --></li><li>runCommand stage: At this stage, Umi runs the current cli command to be executed, (for example <!-- --><code>umi dev</code>, here the dev command will be executed) The various core functionalities of Umi are implemented in the command. Including most of the hooks registered by our plugins calling the api.<!-- --></li></ul><p>The above is the overall process of Umi&#x27;s plugin mechanism.</p><h3 id="register-registermethod-and-applyplugins"><a aria-hidden="true" tabindex="-1" href="#register-registermethod-and-applyplugins"><span class="icon icon-link"></span></a><code>register()</code>, <!-- --><code>registerMethod()</code>, and <!-- --><code>applyPlugins()</code></h3><p><code>register()</code> accepts a key and a hook, maintaining a <!-- --><code>key-hook[]</code> map, each call to <!-- --><code>register()</code> will register an additional hook for the key.<!-- --></p><p><code>register()</code> registered hooks are for use by applyPlugins. The execution sequence of these hooks follows <!-- --><a href="https://github.com/webpack/tapable">tapable</a>.<!-- --></p><p><code>registerMethod()</code> accepts a key and a fn, it registers a method on the api. If no fn is passed to <!-- --><code>registerMethod()</code>, it will register a &quot;register&quot; on the api: it will register the result of <!-- --><code>register()</code> passed in key and curried as fn to the api. This allows for registering hooks for the key quickly by calling this &quot;register&quot;.<!-- --></p><p>For more specific use of the above api, please refer to <!-- --><a href="/en-US/docs/api/plugin-api">Plugin API</a>.<!-- --></p><h3 id="the-principle-of-pluginapi"><a aria-hidden="true" tabindex="-1" href="#the-principle-of-pluginapi"><span class="icon icon-link"></span></a>The Principle of PluginAPI<!-- --></h3><p>Umi assigns a PluginAPI object to each plugin, which references both the plugin itself and Umi&#x27;s service.</p><p>Umi has proxied the <!-- --><code>get()</code> method of the PluginAPI object according to the following rules:<!-- --></p><ul><li>pluginMethod: If prop is a method in Umi&#x27;s maintained <!-- --><code>pluginMethods[]</code> (methods registered through <!-- --><code>registerMethod()</code>), then it returns this method.<!-- --></li><li>service props: If prop is an attribute in the serviceProps array (these attributes are properties that Umi allows plugins direct access to), then it returns the corresponding property of the service.</li><li>static props: If prop is an attribute in the staticProps array (these attributes are static variables, such as some type definitions and constants), then it returns it.</li><li>Otherwise, it returns the property of the api.</li></ul><p>Therefore, most of the apis provided to plugins by Umi are implemented by relying on <!-- --><code>registerMethod()</code>, you can directly use our apis to quickly register hooks in plugins. This is also a manifestation of Umi&#x27;s decoupling of framework and functionalities: Umi&#x27;s service only provides plugin management functionalities, while the apis all rely on plugins to provide.<!-- --></p><h3 id="preset-umi"><a aria-hidden="true" tabindex="-1" href="#preset-umi"><span class="icon icon-link"></span></a>preset-umi<!-- --></h3><p><code>umi-core</code> provides a set of plugin registration and management mechanisms. And Umi&#x27;s core functionalities are all implemented by <!-- --><a href="https://github.com/umijs/umi/tree/master/packages/preset-umi">preset-umi</a>.<!-- --></p><p><code>preset-umi</code> is essentially an inbuilt plugin set, which provides plugins in three categories:<!-- --></p><ul><li>registerMethods, registering some of the &quot;registers&quot; mentioned above for developers to quickly register hooks, occupying most of the PluginAPI.</li><li>features, providing Umi with some features, such as appData, lowImport, mock, etc.</li><li>commands, registering various commands, providing various functionalities of Umi CLI. Umi&#x27;s ability to operate normally in the terminal relies on the functionalities provided by commands.</li></ul></div></div><script>$RC("B:2","S:2")</script>