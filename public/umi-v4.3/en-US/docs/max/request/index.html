<!DOCTYPE html><html><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta property="og:image" content="https://umijs.org/images/og-home.png">
<meta property="og:url" content="https://umijs.org/">
<meta property="og:type" content="article">
<meta property="og:site_name" content="Umi">
<meta property="og:description" content="Umiæ˜¯å¯æ‰©å±•çš„ä¼ä¸šçº§å‰ç«¯åº”ç”¨æ¡†æž¶ã€‚Umi ä»¥è·¯ç”±ä¸ºåŸºç¡€çš„ï¼ŒåŒæ—¶æ”¯æŒé…ç½®å¼è·¯ç”±å’Œçº¦å®šå¼è·¯ç”±ï¼Œä¿è¯è·¯ç”±çš„åŠŸèƒ½å®Œå¤‡ï¼Œå¹¶ä»¥æ­¤è¿›è¡ŒåŠŸèƒ½æ‰©å±•ã€‚ç„¶åŽé…ä»¥ç”Ÿå‘½å‘¨æœŸå®Œå–„çš„æ’ä»¶ä½“ç³»ï¼Œè¦†ç›–ä»Žæºç åˆ°æž„å»ºäº§ç‰©çš„æ¯ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œæ”¯æŒå„ç§åŠŸèƒ½æ‰©å±•å’Œä¸šåŠ¡éœ€æ±‚ã€‚">
<meta property="twitter:image" content="https://umijs.org/images/og-home.png">
<meta property="twitter:site" content="https://umijs.org/">
<meta property="twitter:creator" content="Umi">
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:title" content="Umi">
<meta property="twitter:description" content="Umiæ˜¯å¯æ‰©å±•çš„ä¼ä¸šçº§å‰ç«¯åº”ç”¨æ¡†æž¶ã€‚Umi ä»¥è·¯ç”±ä¸ºåŸºç¡€çš„ï¼ŒåŒæ—¶æ”¯æŒé…ç½®å¼è·¯ç”±å’Œçº¦å®šå¼è·¯ç”±ï¼Œä¿è¯è·¯ç”±çš„åŠŸèƒ½å®Œå¤‡ï¼Œå¹¶ä»¥æ­¤è¿›è¡ŒåŠŸèƒ½æ‰©å±•ã€‚ç„¶åŽé…ä»¥ç”Ÿå‘½å‘¨æœŸå®Œå–„çš„æ’ä»¶ä½“ç³»ï¼Œè¦†ç›–ä»Žæºç åˆ°æž„å»ºäº§ç‰©çš„æ¯ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œæ”¯æŒå„ç§åŠŸèƒ½æ‰©å±•å’Œä¸šåŠ¡éœ€æ±‚ã€‚">
<meta property="fb:app_id" content="922985738798968">
<link rel="shortcut icon" href="https://img.alicdn.com/tfs/TB1YHEpwUT1gK0jSZFhXXaAtVXa-28-27.svg">
<link rel="stylesheet" href="/umi.c9f82ed3.css">
<title data-rh="true">Request</title>
<meta data-rh="true" property="og:title" content="Request"/><meta data-rh="true" name="description" content="@umijs/max has built-in plugin solution. It offers a unified network request and error handling solution based on axios and ahooks&#x27; useRequest from ahooks."/><meta data-rh="true" property="og:description" content="@umijs/max has built-in plugin solution. It offers a unified network request and error handling solution based on axios and ahooks&#x27; useRequest from ahooks."/>
<link data-rh="true" rel="canonical" href="https://umijs.org//en-US/docs/max/request"/>
</head>
<body>
<noscript><b>Enable JavaScript to run this app.</b></noscript><div id="root"><!--$?--><template id="B:0"></template><div></div><!--/$--></div><script>window.__UMI_LOADER_DATA__ = {}</script>
<script async="" src="/umi.0bdf4102.js"></script>

</body></html><div hidden id="S:0"><!--$?--><template id="B:1"></template><div></div><!--/$--></div><script>function $RC(a,b){a=document.getElementById(a);b=document.getElementById(b);b.parentNode.removeChild(b);if(a){a=a.previousSibling;var f=a.parentNode,c=a.nextSibling,e=0;do{if(c&&8===c.nodeType){var d=c.data;if("/$"===d)if(0===e)break;else e--;else"$"!==d&&"$?"!==d&&"$!"!==d||e++}d=c.nextSibling;f.removeChild(c);c=d}while(c);for(;b.firstChild;)f.insertBefore(b.firstChild,c);a.data="$";a._reactRetry&&a._reactRetry()}};$RC("B:0","S:0")</script><div hidden id="S:1"><div class="dumi-default-doc-layout"><div class="dumi-default-header"><div class="dumi-default-header-content"><section class="dumi-default-header-left"><a class="dumi-default-logo" href="/en-US"><img src="https://gw.alipayobjects.com/zos/bmw-prod/598d14af-4f1c-497d-b579-5ac42cd4dd1f/k7bjua9c_w132_h130.png" alt="UmiJS"/>UmiJS<!-- --></a></section><section class="dumi-default-header-right"><ul class="dumi-default-navbar"><li><a href="/en-US/docs/introduce/introduce">Introduce</a></li><li><a href="/en-US/docs/guides/getting-started">Guide</a></li><li><a href="/en-US/docs/api/api">API</a></li><li><a class="active" href="/en-US/docs/max/introduce">Umi Max</a></li><li><a href="/en-US/blog/umi-4-rc">Blog</a></li></ul><div class="dumi-default-header-right-aside"><div class="dumi-default-search-bar"><svg viewBox="64 64 896 896" class="dumi-default-search-bar-svg"><path d="M909.6 854.5 649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0 0 11.6 0l43.6-43.5a8.2 8.2 0 0 0 0-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"></path></svg><input class="dumi-default-search-bar-input" placeholder="Type keywords..."/><span class="dumi-default-search-shortcut">âŒ˜<!-- --> K<!-- --></span></div><a class="dumi-default-lang-switch" href="/docs/max/request">ä¸­æ–‡</a><span class="dumi-default-color-switch" data-dumi-tooltip="Light Mode" data-dumi-tooltip-bottom="true"><svg viewBox="0 0 16 16"><path d="M8 13a1 1 0 0 1 1 1v1a1 1 0 1 1-2 0v-1a1 1 0 0 1 1-1ZM8 3a1 1 0 0 1-1-1V1a1 1 0 1 1 2 0v1a1 1 0 0 1-1 1Zm7 4a1 1 0 1 1 0 2h-1a1 1 0 1 1 0-2h1ZM3 8a1 1 0 0 1-1 1H1a1 1 0 1 1 0-2h1a1 1 0 0 1 1 1Zm9.95 3.536.707.707a1 1 0 0 1-1.414 1.414l-.707-.707a1 1 0 0 1 1.414-1.414Zm-9.9-7.072-.707-.707a1 1 0 0 1 1.414-1.414l.707.707A1 1 0 0 1 3.05 4.464Zm9.9 0a1 1 0 0 1-1.414-1.414l.707-.707a1 1 0 0 1 1.414 1.414l-.707.707Zm-9.9 7.072a1 1 0 0 1 1.414 1.414l-.707.707a1 1 0 0 1-1.414-1.414l.707-.707ZM8 4a4 4 0 1 0 0 8 4 4 0 0 0 0-8Zm0 6.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5Z"></path></svg><select><option value="light" selected="">Light Mode<!-- --></option><option value="dark">Dark Mode<!-- --></option><option value="auto">Follow System<!-- --></option></select></span><a class="dumi-default-icon" data-dumi-tooltip="GitHub" data-dumi-tooltip-bottom="true" target="_blank" href="https://github.com/umijs/umi" rel="noreferrer"><svg viewBox="64 64 896 896"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></a><div class="dumi-default-lang-select" style="border-inline-start:1px solid #d0d5d8;margin-inline-start:15px;padding-inline-start:5px"><select style="padding-top:1px;padding-bottom:1px"><option value="4.3.31" selected="">4.3.31<!-- --></option><option value="3.x">3.x<!-- --></option></select><svg viewBox="64 64 896 896"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></div></div></section><button type="button" class="dumi-default-header-menu-btn"><svg viewBox="64 64 896 896"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></button></div></div><div class="dumi-default-doc-layout-mobile-bar"><button type="button" class="dumi-default-sidebar-btn"><svg viewBox="64 64 896 896"><path d="M120 230h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm0 424h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm784 140H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-424H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"></path></svg>Sidebar<!-- --></button></div><main><div class="dumi-default-sidebar"><dl class="dumi-default-sidebar-group"><dd><a title="Umi Max Introduction" class="" href="/en-US/docs/max/introduce">Umi Max Introduction</a></dd><dd><a title="Layout and Menu" class="" href="/en-US/docs/max/layout-menu">Layout and Menu</a></dd><dd><a title="antd" class="" href="/en-US/docs/max/antd">antd</a></dd><dd><a title="Charts" class="" href="/en-US/docs/max/charts">Charts</a></dd><dd><a title="Data Stream" class="" href="/en-US/docs/max/data-flow">Data Stream</a></dd><dd><a title="Request" aria-current="page" class="active" href="/en-US/docs/max/request">Request</a></dd><dd><a title="Permissions" class="" href="/en-US/docs/max/access">Permissions</a></dd><dd><a title="Internationalization" class="" href="/en-US/docs/max/i18n">Internationalization</a></dd><dd><a title="Micro Frontends" class="" href="/en-US/docs/max/micro-frontend">Micro Frontends</a></dd><dd><a title="styled-components" class="" href="/en-US/docs/max/styled-components">styled-components</a></dd><dd><a title="react-query" class="" href="/en-US/docs/max/react-query">react-query</a></dd><dd><a title="valtio" class="" href="/en-US/docs/max/valtio">valtio</a></dd><dd><a title="dva" class="" href="/en-US/docs/max/dva">dva</a></dd><dd><a title="Site Statistics" class="" href="/en-US/docs/max/analytics">Site Statistics</a></dd><dd><a title="Module Federation Plugin" class="" href="/en-US/docs/max/mf">Module Federation Plugin</a></dd></dl></div><div class="dumi-default-content"><article><!--$?--><template id="B:2"></template><div></div><!--/$--></article><footer class="dumi-default-content-footer"><dl><dd><svg viewBox="64 64 896 896"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"></path><path d="M686.7 638.6 544.1 535.5V288c0-4.4-3.6-8-8-8H488c-4.4 0-8 3.6-8 8v275.4c0 2.6 1.2 5 3.3 6.5l165.4 120.6c3.6 2.6 8.6 1.8 11.2-1.7l28.6-39c2.6-3.7 1.8-8.7-1.8-11.2z"></path></svg>Last updated: <!-- --><time dateTime=""></time></dd></dl><nav></nav></footer><div class="dumi-default-footer">Open-source MIT Licensed | Copyright Â© 2017-present</div></div><div class="dumi-default-doc-layout-toc-wrapper"><h4>TABLE OF CONTENTS</h4></div></main></div></div><script>$RC("B:1","S:1")</script><div hidden id="S:2"><div class="markdown"><h1 id="request"><a aria-hidden="true" tabindex="-1" href="#request"><span class="icon icon-link"></span></a>Request<!-- --></h1><p><code>@umijs/max</code> has built-in plugin solution. It offers a unified network request and error handling solution based on <!-- --><a href="https://axios-http.com/">axios</a> and ahooks&#x27; <!-- --><code>useRequest</code> from <!-- --><a href="https://ahooks-v2.surge.sh">ahooks</a>.<!-- --></p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-js"><div class=""><div class=""><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> request</span><span class="token imports punctuation">,</span><span class="token imports"> useRequest </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;umi&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">
</span></div></div><div class=""><div class=""><span class="token plain">request</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">useRequest</span><span class="token punctuation">;</span></div></div></pre></div><h2 id="configuration"><a aria-hidden="true" tabindex="-1" href="#configuration"><span class="icon icon-link"></span></a>Configuration<!-- --></h2><h3 id="build-time-configuration"><a aria-hidden="true" tabindex="-1" href="#build-time-configuration"><span class="icon icon-link"></span></a>Build-time configuration<!-- --></h3><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-js"><div class=""><div class=""><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token literal-property property">request</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token literal-property property">dataField</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;data&#x27;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></div></pre></div><p>Build-time configuration allows configuring <!-- --><code>dataField</code> for useRequest, with its default being <!-- --><code>data</code>. This setting primarily facilitates direct data consumption by useRequest. If you wish to access the raw data returned by the backend when consuming data, configure <!-- --><code>dataField</code> to <!-- --><code>&#x27;&#x27;</code> here.<!-- --></p><p>For example, if your backend returns data in the following format.</p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-js"><div class=""><div class=""><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token literal-property property">success</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token literal-property property">data</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">123</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token literal-property property">code</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token punctuation">}</span></div></div></pre></div><p>Then useRequest can directly consume the <!-- --><code>data</code>, which would be 123, instead of <!-- --><code>{ success, data, code }</code>.<!-- --></p><h3 id="runtime-configuration"><a aria-hidden="true" tabindex="-1" href="#runtime-configuration"><span class="icon icon-link"></span></a>Runtime configuration<!-- --></h3><p>In <!-- --><code>src/app.ts</code>, you can customize the request settings for your project by configuring the request item.<!-- --></p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-ts"><div class=""><div class=""><span class="token keyword">import</span><span class="token plain"> </span><span class="token keyword">type</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> RequestConfig </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;umi&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">
</span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token keyword">export</span><span class="token plain"> </span><span class="token keyword">const</span><span class="token plain"> request</span><span class="token operator">:</span><span class="token plain"> RequestConfig </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  timeout</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token comment">// other axios options you want</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  errorConfig</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token function">errorHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token function">errorThrower</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  requestInterceptors</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  responseInterceptors</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></div></pre></div><p>Besides <!-- --><code>errorConfig</code>, <!-- --><code>requestInterceptors</code>, and <!-- --><code>responseInterceptors</code>, other configurations are directly passed through to <!-- --><a href="https://axios-http.com/docs/req_config">axios</a>&#x27;s request configuration. <!-- --><strong>The rules configured here apply to all</strong> <!-- --><code>request</code> and <!-- --><code>useRequest</code> <!-- --><strong>methods</strong>.<!-- --></p><p>The runtime configuration options of <!-- --><code>plugin-request</code> are introduced below. At the end of this section, we will provide a complete runtime configuration example, describing its functionality in detail.<!-- --></p><h4 id="errorconfig"><a aria-hidden="true" tabindex="-1" href="#errorconfig"><span class="icon icon-link"></span></a>errorConfig<!-- --></h4><p>If you want to set a unified error handling scheme for your requests, you can configure it here.</p><p><code>errorThrower</code> takes the data returned by your backend and needs to throw an error you define. You can process the backend data here as needed.<!-- --></p><p>Our <!-- --><code>request</code> will catch the error thrown by <!-- --><code>errorThrower</code> and execute your <!-- --><code>errorHandler</code> method, which accepts two arguments. The first argument is the caught error, and the second argument is the request&#x27;s opts.<!-- --></p><p><code>errorHandler</code> and <!-- --><code>errorThrower</code> need to be used together. A complete example is provided at the end of the document.<!-- --></p><p>If you find this way of error handling too complicated, you can directly implement your error handling in the interceptors.</p></div><div class="dumi-default-container markdown" data-type="info"><svg viewBox="64 64 896 896"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"></path><path d="M464 336a48 48 0 1 0 96 0 48 48 0 1 0-96 0zm72 112h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V456c0-4.4-3.6-8-8-8z"></path></svg><h4>ðŸš¨</h4><section><p><code>errorThrower</code> is implemented using <!-- --><code>responseInterceptors</code>, triggered when <!-- --><code>data.success</code> is <!-- --><code>false</code>.<!-- --></p></section></div><div class="markdown"><h4 id="requestinterceptors"><a aria-hidden="true" tabindex="-1" href="#requestinterceptors"><span class="icon icon-link"></span></a>requestInterceptors<!-- --></h4><p>Add request phase interceptors to the request method.</p><p>Pass in an array where each element is an interceptor. They will be registered on the axios instance in order. The syntax for writing interceptors is consistent with axios request interceptor. It needs to take the request config as an argument and return it.</p><p>We recommend using <!-- --><code>RequestConfig</code>, which helps you write your interceptors in a standardized manner.<!-- --></p><p>e.g.</p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-ts"><div class=""><div class=""><span class="token keyword">const</span><span class="token plain"> request</span><span class="token operator">:</span><span class="token plain"> RequestConfig </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  requestInterceptors</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token comment">// directly write a function as an interceptor</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">,</span><span class="token plain"> options</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">      </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">        </span><span class="token comment">// do something</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">        </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> url</span><span class="token punctuation">,</span><span class="token plain"> options </span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token comment">// a tuple, the first element is the request interceptor, the second is the error handler</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">,</span><span class="token plain"> options</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> url</span><span class="token punctuation">,</span><span class="token plain"> options </span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token keyword">return</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token comment">// array, omitting error handler</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">,</span><span class="token plain"> options</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> url</span><span class="token punctuation">,</span><span class="token plain"> options </span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token punctuation">]</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">
</span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token punctuation">}</span></div></div></pre></div><p>Furthermore, to better accommodate umi-request, we allow umi-request interceptor syntax, even though it might not pass TypeScript&#x27;s syntax check.</p><h4 id="responseinterceptors"><a aria-hidden="true" tabindex="-1" href="#responseinterceptors"><span class="icon icon-link"></span></a>responseInterceptors<!-- --></h4><p>Add response phase interceptors to the request method.</p><p>Pass in an array where each element is an interceptor. They will be registered on the axios instance in order. The syntax for writing interceptors is consistent with axios response interceptor. It takes the axios response as an argument and returns it.</p><p>We recommend using <!-- --><code>RequestConfig</code>, which helps you write your interceptors in a standardized manner.<!-- --></p><p>e.g.</p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-ts"><div class=""><div class=""><span class="token keyword">const</span><span class="token plain"> request</span><span class="token operator">:</span><span class="token plain"> RequestConfig </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  responseInterceptors</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token comment">// directly write a function as an interceptor</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token punctuation">(</span><span class="token plain">response</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">      </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">        </span><span class="token comment">// No need for asynchronous processing to read response body content, can directly read from data, some fields can be found in the config</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">        </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> data </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">as</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation">,</span><span class="token plain"> config </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> response</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">        </span><span class="token comment">// do something</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">        </span><span class="token keyword">return</span><span class="token plain"> response</span></div></div><div class=""><div class=""><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token comment">// a tuple, the first element is the request interceptor, the second is the error handler</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token plain">response</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token keyword">return</span><span class="token plain"> response</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token keyword">return</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token comment">// array, omitting error handler</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token plain">response</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token keyword">return</span><span class="token plain"> response</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token punctuation">]</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">
</span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token punctuation">}</span></div></div></pre></div><p><strong>Note: We will register interceptors according to your array sequence, but their execution order follows axios&#x27;s convention, with request interceptors added later executing first, and response interceptors added later executing last</strong></p><h2 id="api"><a aria-hidden="true" tabindex="-1" href="#api"><span class="icon icon-link"></span></a>API<!-- --></h2><h3 id="userequest"><a aria-hidden="true" tabindex="-1" href="#userequest"><span class="icon icon-link"></span></a>useRequest<!-- --></h3><p>The plugin has built-in <!-- --><a href="https://ahooks-v2.js.org/hooks/async">@ahooksjs/useRequest</a>, allowing you to consume data simply and conveniently within components. The example is as follows:<!-- --></p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-typescript"><div class=""><div class=""><span class="token keyword">import</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> useRequest </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;umi&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">
</span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token keyword">export</span><span class="token plain"> </span><span class="token keyword">default</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> data</span><span class="token punctuation">,</span><span class="token plain"> error</span><span class="token punctuation">,</span><span class="token plain"> loading </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useRequest</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> services</span><span class="token punctuation">.</span><span class="token function">getUserList</span><span class="token punctuation">(</span><span class="token string">&#x27;/api/test&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">loading</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">div</span><span class="token operator">&gt;</span><span class="token plain">loading</span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">div</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">div</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token plain">error</span><span class="token punctuation">.</span><span class="token plain">message</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">div</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">div</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token plain">data</span><span class="token punctuation">.</span><span class="token plain">name</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">div</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></div></pre></div><p>In the above code, <!-- --><code>data</code> is not the data returned by your backend, but its internal <!-- --><code>data</code>, (because the default build-time configuration is &#x27;data&#x27;)<!-- --></p><p>It should be noted that ahooks has been updated to 3.0, but for making it less difficult for <!-- --><code>umi@3</code> projects to upgrade, we continued to use ahooks 2.0<!-- --></p><h3 id="request-1"><a aria-hidden="true" tabindex="-1" href="#request-1"><span class="icon icon-link"></span></a>request<!-- --></h3><p>By <!-- --><code>import { request } from &#x27;@@/plugin-request&#x27;</code>, you can use the built-in request method.<!-- --></p><p><code>request</code> accepts <!-- --><code>options</code> in addition to passing through all of <!-- --><a href="https://axios-http.com/docs/req_config">axios</a>&#x27;s config, we also added a few extra attributes <!-- --><code>skipErrorHandler</code>, <!-- --><code>getResponse</code>, <!-- --><code>requestInterceptors</code> and <!-- --><code>responseInterceptors</code>.<!-- --></p><p>The example is as follows:</p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-typescript"><div class=""><div class=""><span class="token function">request</span><span class="token punctuation">(</span><span class="token string">&#x27;/api/user&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  params</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> name </span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  timeout</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">2000</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token comment">// other axios options</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  skipErrorHandler</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  getResponse</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  requestInterceptors</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  responseInterceptors</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token punctuation">}</span></div></div></pre></div><p>When you want a particular request to skip error handling, you can achieve this by setting <!-- --><code>skipErrorHandler</code> to <!-- --><code>true</code>.<!-- --></p><p>request returns the data from your backend by default, if you wish to receive the complete response structure from axios, it can be achieved by passing <!-- --><code>{ getResponse: true }</code>.<!-- --></p><p><code>requestInterceptors</code> and <!-- --><code>responseInterceptors</code> are written in the same way as the interceptors in runtime configuration, but the difference is that the interceptors registered here are &quot;one-off&quot;. Furthermore, the interceptors written here will be registered after those in the runtime configuration.<!-- --></p><p><strong>Note: When you have used errorHandler, the response interceptors registered here will be ineffective, because errorHandler will throw error</strong></p><h3 id="requestconfig"><a aria-hidden="true" tabindex="-1" href="#requestconfig"><span class="icon icon-link"></span></a>RequestConfig<!-- --></h3><p>This is an interface definition that can help you better configure runtime settings.</p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-typescript"><div class=""><div class=""><span class="token keyword">import</span><span class="token plain"> </span><span class="token keyword">type</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> RequestConfig </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;umi&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">
</span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token keyword">export</span><span class="token plain"> </span><span class="token keyword">const</span><span class="token plain"> request</span><span class="token operator">:</span><span class="token plain">RequestConfig </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></div></pre></div><p>Note that you should add type when importing</p><h2 id="umi3-to-umi4"><a aria-hidden="true" tabindex="-1" href="#umi3-to-umi4"><span class="icon icon-link"></span></a>umi@3 to umi@4<!-- --></h2><p>In the upgrade from <!-- --><code>umi@3</code> to <!-- --><code>umi@4</code>, we discontinued umi-request and chose axios as the default request solution. Some functionality changes occurred in this switch.<!-- --></p><h3 id="changes-in-runtime-configuration"><a aria-hidden="true" tabindex="-1" href="#changes-in-runtime-configuration"><span class="icon icon-link"></span></a>Changes in runtime configuration<!-- --></h3><p>Compared to <!-- --><code>umi@3</code>, <!-- --><code>umi@4</code>&#x27;s runtime configuration has undergone significant changes.<!-- --></p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-diff"><div class=""><div class=""><span class="token plain">export const request: RequestConfig = {</span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">     errorConfig: {</span></div></div><div class=""><div class=""><span class="token unchanged line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">+      errorHandler: () =&gt; {},</span></div></div><div class=""><div class=""><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">+      errorThrower: () =&gt; {}</span></div></div><div class=""><div class=""><span class="token inserted-sign inserted line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">-      errorPage: &#x27;&#x27;,</span></div></div><div class=""><div class=""><span class="token deleted-sign deleted line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">-      adaptor: ()=&gt;{},</span></div></div><div class=""><div class=""><span class="token deleted-sign deleted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">     };</span></div></div><div class=""><div class=""><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">-    middlewares: [],</span></div></div><div class=""><div class=""><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">+    requestInterceptors: [],</span></div></div><div class=""><div class=""><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">+    responseInterceptors: [],</span></div></div><div class=""><div class=""><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">     ... // Differences between umi-request and axios.</span></div></div><div class=""><div class=""><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   };</span></div></div></pre></div><ul><li>umi-request&#x27;s configuration items have become axios&#x27;s configuration items.</li><li>Removed the middlewares middleware. You can use axios&#x27;s <!-- --><a href="https://axios-http.com/docs/interceptors">interceptors</a> to achieve the same functionality.<!-- --></li><li>errorConfig removed all original settings, adding errorHandler and errorThrower for unified error handling settings.</li></ul><p>Replacing middleware. For a <!-- --><code>umi@3</code> middleware, content before the <!-- --><code>next()</code> method should be placed in <!-- --><code>requestInterceptors</code>, while content after the <!-- --><code>next()</code> method should be placed in <!-- --><code>responseInterceptors</code>.<!-- --></p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-ts"><div class=""><div class=""><span class="token comment">// Middleware</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token plain">ctx</span><span class="token punctuation">,</span><span class="token plain"> next</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> url</span><span class="token punctuation">,</span><span class="token plain"> options </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> req</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&#x27;/api&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    ctx</span><span class="token punctuation">.</span><span class="token plain">req</span><span class="token punctuation">.</span><span class="token plain">url </span><span class="token operator">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">/api/v1/</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">url</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token keyword">await</span><span class="token plain"> </span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">ctx</span><span class="token punctuation">.</span><span class="token plain">res</span><span class="token punctuation">.</span><span class="token plain">success</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token comment">// do something</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">
</span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token comment">// Interceptor</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  requestInterceptors</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token punctuation">(</span><span class="token plain">config</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">      </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">config</span><span class="token punctuation">.</span><span class="token plain">url</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&#x27;/api&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">        config</span><span class="token punctuation">.</span><span class="token plain">url </span><span class="token operator">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">/api/v1/</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">url</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> config</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  responseInterceptors</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token punctuation">(</span><span class="token plain">response</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">response</span><span class="token punctuation">.</span><span class="token plain">data</span><span class="token punctuation">.</span><span class="token plain">success</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">      </span><span class="token comment">// do something</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token punctuation">]</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token punctuation">}</span></div></div></pre></div><h3 id="changes-in-request-method-parameters"><a aria-hidden="true" tabindex="-1" href="#changes-in-request-method-parameters"><span class="icon icon-link"></span></a>Changes in request method parameters<!-- --></h3><p><a href="https://github.com/umijs/umi-request#request-options">umi-request</a> and <!-- --><a href="https://axios-http.com/docs/req_config">axios</a> have some differences in configuration items. You can compare them by referring to their respective documentation.<!-- --></p><h3 id="get-request-parameter-serialization"><a aria-hidden="true" tabindex="-1" href="#get-request-parameter-serialization"><span class="icon icon-link"></span></a>GET request parameter serialization<!-- --></h3><p><a href="https://github.com/umijs/umi-request/blob/master/src/middleware/simpleGet.js">Umi@3</a> uses the same Key to serialize arrays by default. Umi@4 requests based on axios, by default, serialize in the form with brackets <!-- --><code>[]</code>.<!-- --></p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-tsx"><div class=""><div class=""><span class="token comment">// Umi@3</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> useRequest </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;umi&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token comment">// a: [1,2,3] =&gt; a=1&amp;a=2&amp;a=3</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">
</span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token comment">// Umi@4</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> useRequest </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;@umijs/max&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token comment">// a: [1,2,3] =&gt; a[]=1&amp;a[]=2&amp;a[]=3</span></div></div></pre></div><p>If you wish to maintain the Umi@3 form, you can do so:</p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-ts"><div class=""><div class=""><span class="token comment">// src/app.[ts|tsx]</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">
</span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token comment">/** @doc https://github.com/sindresorhus/query-string#arrayformat-1 */</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token operator">+</span><span class="token plain"> </span><span class="token keyword">import</span><span class="token plain"> queryString </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;query-string&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">
</span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token keyword">export</span><span class="token plain"> </span><span class="token keyword">const</span><span class="token plain"> request</span><span class="token operator">:</span><span class="token plain"> RequestConfig </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token operator">+</span><span class="token plain">  </span><span class="token function">paramsSerializer</span><span class="token punctuation">(</span><span class="token plain">params</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token operator">+</span><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> queryString</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token plain">params</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token operator">+</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">   </span><span class="token operator">...</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token punctuation">}</span></div></div></pre></div><h2 id="runtime-configuration-example"><a aria-hidden="true" tabindex="-1" href="#runtime-configuration-example"><span class="icon icon-link"></span></a>Runtime configuration example<!-- --></h2><p>Here&#x27;s a complete example of runtime configuration, to help you better customize the request scheme for your project.</p><div class="dumi-default-source-code"><button type="button" class="dumi-default-source-code-copy"><svg viewBox="64 64 896 896"><path d="M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2 263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"></path></svg></button><pre class="prism-code language-ts"><div class=""><div class=""><span class="token keyword">import</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> RequestConfig </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;./request&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">
</span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token comment">// Error handling scheme: Error types</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token keyword">enum</span><span class="token plain"> ErrorShowType </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token constant">SILENT</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token constant">WARN_MESSAGE</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token constant">ERROR_MESSAGE</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token constant">NOTIFICATION</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token constant">REDIRECT</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">9</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token comment">// Response data structure agreed with the backend</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token keyword">interface</span><span class="token plain"> </span><span class="token class-name">ResponseStructure</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  success</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  data</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  errorCode</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  errorMessage</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  showType</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> ErrorShowType</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">
</span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token comment">// Runtime configuration</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token keyword">export</span><span class="token plain"> </span><span class="token keyword">const</span><span class="token plain"> request</span><span class="token operator">:</span><span class="token plain"> RequestConfig </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token comment">// Unified request settings</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  timeout</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  headers</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token string-property property">&#x27;X-Requested-With&#x27;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;XMLHttpRequest&#x27;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">
</span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token comment">// Error handling: umi@3&#x27;s error handling scheme.</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  errorConfig</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token comment">// Error throwing</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token function-variable function">errorThrower</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">res</span><span class="token operator">:</span><span class="token plain"> ResponseStructure</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">      </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> success</span><span class="token punctuation">,</span><span class="token plain"> data</span><span class="token punctuation">,</span><span class="token plain"> errorCode</span><span class="token punctuation">,</span><span class="token plain"> errorMessage</span><span class="token punctuation">,</span><span class="token plain"> showType </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> res</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">      </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">success</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">        </span><span class="token keyword">const</span><span class="token plain"> error</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token plain">errorMessage</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">        error</span><span class="token punctuation">.</span><span class="token plain">name </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;BizError&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">        error</span><span class="token punctuation">.</span><span class="token plain">info </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> errorCode</span><span class="token punctuation">,</span><span class="token plain"> errorMessage</span><span class="token punctuation">,</span><span class="token plain"> showType</span><span class="token punctuation">,</span><span class="token plain"> data </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">        </span><span class="token keyword">throw</span><span class="token plain"> error</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// Throw custom error</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token comment">// Error catching and handling</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token function-variable function">errorHandler</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation">,</span><span class="token plain"> opts</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">      </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">opts</span><span class="token operator">?.</span><span class="token plain">skipErrorHandler</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">throw</span><span class="token plain"> error</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">      </span><span class="token comment">// The errors thrown by our errorThrower.</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">      </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token punctuation">.</span><span class="token plain">name </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;BizError&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">        </span><span class="token keyword">const</span><span class="token plain"> errorInfo</span><span class="token operator">:</span><span class="token plain"> ResponseStructure </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword">undefined</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> error</span><span class="token punctuation">.</span><span class="token plain">info</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">        </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">errorInfo</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">          </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> errorMessage</span><span class="token punctuation">,</span><span class="token plain"> errorCode </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> errorInfo</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">          </span><span class="token keyword">switch</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">errorInfo</span><span class="token punctuation">.</span><span class="token plain">showType</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">            </span><span class="token keyword">case</span><span class="token plain"> ErrorShowType</span><span class="token punctuation">.</span><span class="token constant">SILENT</span><span class="token operator">:</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">              </span><span class="token comment">// do nothing</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">              </span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">            </span><span class="token keyword">case</span><span class="token plain"> ErrorShowType</span><span class="token punctuation">.</span><span class="token constant">WARN_MESSAGE</span><span class="token operator">:</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">              message</span><span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token plain">errorMessage</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">              </span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">            </span><span class="token keyword">case</span><span class="token plain"> ErrorShowType</span><span class="token punctuation">.</span><span class="token constant">ERROR_MESSAGE</span><span class="token operator">:</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">              message</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token plain">errorMessage</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">              </span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">            </span><span class="token keyword">case</span><span class="token plain"> ErrorShowType</span><span class="token punctuation">.</span><span class="token constant">NOTIFICATION</span><span class="token operator">:</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">              notification</span><span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">                description</span><span class="token operator">:</span><span class="token plain"> errorMessage</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">                message</span><span class="token operator">:</span><span class="token plain"> errorCode</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">              </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">              </span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">            </span><span class="token keyword">case</span><span class="token plain"> ErrorShowType</span><span class="token punctuation">.</span><span class="token constant">REDIRECT</span><span class="token operator">:</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">              </span><span class="token comment">// TODO: redirect</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">              </span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">            </span><span class="token keyword">default</span><span class="token operator">:</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">              message</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token plain">errorMessage</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">          </span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token punctuation">.</span><span class="token plain">response</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">        </span><span class="token comment">// Axios error</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">        </span><span class="token comment">// The request was made, and the server responded with a status code that falls out of the range of 2xx</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">        message</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">Response status:</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">error</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation">response</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation">status</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token punctuation">.</span><span class="token plain">request</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">        </span><span class="token comment">// The request was made but no response was received</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">        </span><span class="token comment">// \`error.request\` is an instance of XMLHttpRequest in the browser and an instance of</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">        </span><span class="token comment">// http.ClientRequest in node.js</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">        message</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#x27;None response! Please retry.&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">        </span><span class="token comment">// Something happened in setting up the request that triggered an error</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">        message</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#x27;Request error, please retry.&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">
</span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">
</span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token comment">// Request interceptors</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  requestInterceptors</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token punctuation">(</span><span class="token plain">config</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token comment">// Intercept request configurations for personalized processing.</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">      </span><span class="token keyword">const</span><span class="token plain"> url </span><span class="token operator">=</span><span class="token plain"> config</span><span class="token punctuation">.</span><span class="token plain">url</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">&#x27;?token = 123&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">...</span><span class="token plain">config</span><span class="token punctuation">,</span><span class="token plain"> url</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">
</span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token comment">// Response interceptors</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  responseInterceptors</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token punctuation">(</span><span class="token plain">response</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">       </span><span class="token comment">// Intercept the response data for personalized processing</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">       </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> data </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> response</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">       </span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">data</span><span class="token punctuation">.</span><span class="token plain">success</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">         message</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#x27;Request failed!&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">       </span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">       </span><span class="token keyword">return</span><span class="token plain"> response</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain">  </span><span class="token punctuation">]</span><span class="token plain"></span></div></div><div class=""><div class=""><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></div></pre></div><p>The above example&#x27;s error handling scheme is derived from <!-- --><code>umi@3</code>&#x27;s built-in error handling. In this version, we removed it to allow users greater freedom in customizing their error handling schemes. If you still want to use it, you can paste this runtime configuration into your project.<!-- --></p><p>You can also write your own error handling through response interceptors, <!-- --><strong>not limited to errorConfig</strong>.<!-- --></p></div></div><script>$RC("B:2","S:2")</script>